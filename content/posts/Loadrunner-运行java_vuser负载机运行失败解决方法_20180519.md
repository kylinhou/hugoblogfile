---
title: 运行java_vuser时添加负载机运行失败
grammar_cjkRuby: true
date: 2016-09-28
categories: ["性能测试"]
tags: ["性能测试", "loadrunner"]
author: "kylin"
---

# 运行java vuser时添加负载机运行失败

### 问题描述

这次测试的接口是调用rpc，tps到2、3万，场景中已经添加了7台负载机，但是负载机的cpu使用仍然达到100%，负载机的性能已经影响到本次测试了，所以想多添加几台负载机。奇怪的是新添加的几台负载机运行场景之后，vuser直接是failed状态，不能正常运行，脚本中引用到的jar文件已经放到了相应的位置，但是就是不行。

<!--more-->

### 问题原因

负载机之间的jdk版本不一致！！！

主压测机是185，jdk的版本是1.6.0，添加的12和14 的jdk版本是1.6.45，导致运行失败，重新安装jdk版本，问题解决。

185和12是不同网段的，但是没有影响，之前以为是网段不同造成的，实验发现无影响。

### 压测机对性能测试的影响

正好看到了这一篇文章，分享下：http://orange2015.blog.163.com/blog/static/245875047201502755714613/

文章中说：

>线下测试达到目标后，系统上线却出现了性能问题，而 TPS并没有线下测试的高，认真分析后，发现问题在于，我们测试的场景还是与线上有很大的差异，线上是很多Client请求造成的压力，而线下测试Client数量去只有一台，虽然并发请求的量可能相同，可对系统造成的压力去有很大的不同，为什么压力不同，线上的情况就是一个有力的证明，探究原因，应有不少，比如线上测试时，单台client自身压力比较大，对服务器压力有影响，1台Client并发40个请求与10台Client并发4个请求对服务器进行施压的效果一定是不同的。

这个地方以后确实需要注意一下，压测机cpu如果一直在85%以上就需要考虑多加几台压测机

在测试过程中会经常遇到这样一个现象：开始时tps很高很稳定，但是没过几分钟tps开始下降，最后降为0。服务器都没有压力，这时候看一下负载机的资源使用情况，往往会发现负载机的cpu占用很高，这种情况就是由于负载机资源不足引起的。



